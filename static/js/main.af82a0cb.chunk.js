(this["webpackJsonpworking-title"]=this["webpackJsonpworking-title"]||[]).push([[0],{153:function(e,t,n){},154:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(10),o=n.n(a),i=n(54),s=n(11),u=n(188),l=n(98),d=Object(l.a)({palette:{type:"dark"}}),j=n(20),b=n(184),f=n(182),h=Object(r.createContext)({stream:null,setStream:function(){}}),p=n(6),m=Object(f.a)({container:{width:"100vw",height:"100vh",position:"relative"}}),g=function(e){var t=e.children,n=m(),c=Object(r.useState)(null),a=Object(j.a)(c,2),o=a[0],i=a[1];return Object(p.jsx)(h.Provider,{value:{stream:o,setStream:i},children:Object(p.jsx)(b.a,{container:!0,className:n.container,children:t})})},O=n(14),x=n.n(O),v=n(30),w=n(99),k=n(186),C=n(187),y=n(192),S=n(190),E=n(191),D=n(97),T=n.n(D),N=n(100),R=n(96);console.log("ws server:","wss://working-title-webrtc.herokuapp.com");var I=Object(R.io)("wss://working-title-webrtc.herokuapp.com");I.on("connect",(function(){return console.log("connect")})),I.on("reconnect",(function(){return console.log("reconnect")})),I.on("disconnect",(function(){return console.log("disconnect")})),I.on("connect_error",(function(e){return console.log("connect_error",e)}));var P=I;function L(e){var t=e.event,n=Object(N.a)(e,["event"]);return new Promise((function(e){I.emit(t,n,e)}))}var F=n(48),z=n.n(F);function B(){return navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:{width:640,height:480,frameRate:30},audio:!1}).then((function(e){return e}),(function(e){switch(e.name){case"NotFoundError":alert("Unable to open your call because no camera and/or microphone were found.");break;case"SecurityError":case"PermissionDeniedError":alert("You can not use video conference w/o granting access to the camera and/or microphone.");break;default:alert("Error opening your camera and/or microphone: "+e.message)}throw e})):Promise.resolve(null)}var J=Object(f.a)((function(e){return{title:{marginBottom:e.spacing(2)},actions:{marginTop:e.spacing(2)},create:{marginRight:e.spacing(2)},join:{marginLeft:e.spacing(2)},video:{width:"640px",height:"480px",backgroundColor:"rgb(0, 0, 0)"},player:{width:"100%",height:"100%"}}}));var A=function(){var e=J(),t=Object(s.f)(),n=Object(r.useState)(""),c=Object(j.a)(n,2),a=c[0],o=c[1],i=Object(r.useState)(!1),u=Object(j.a)(i,2),l=u[0],d=u[1],f=Object(r.useState)(!0),m=Object(j.a)(f,2),g=m[0],O=m[1],D=Object(r.useState)(!1),N=Object(j.a)(D,2),R=N[0],I=N[1],P=Object(r.useRef)(null),F=Object(r.useContext)(h).setStream;Object(r.useEffect)((function(){B().then((function(e){P.current&&(P.current.srcObject=e),F(e)})).catch(console.error)}),[]),Object(r.useEffect)((function(){I(!1),a.length?d(!0):d(!1)}),[a]);var A=Object(r.useCallback)(Object(v.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L({event:"join",room:a});case 2:e.sent?t.push("/".concat(a)):I(!0);case 4:case"end":return e.stop()}}),e)}))),[t,a]),M=Object(r.useCallback)(Object(v.a)(x.a.mark((function e(){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(w.a)(),e.next=3,L({event:"create",room:n});case 3:e.sent&&t.push("/".concat(n));case 5:case"end":return e.stop()}}),e)}))),[t]);return Object(p.jsxs)(b.a,{container:!0,children:[Object(p.jsx)(b.a,{container:!0,item:!0,sm:6,alignItems:"center",justify:"flex-end",children:Object(p.jsxs)(b.a,{container:!0,item:!0,sm:10,direction:"column",children:[Object(p.jsxs)(b.a,{container:!0,direction:"column",className:e.title,children:[Object(p.jsx)(k.a,{variant:"h5",children:"The most secure video conference powered by WebRTC"}),Object(p.jsx)(k.a,{variant:"subtitle1",children:"Create new room or join the existing one"})]}),Object(p.jsx)(C.a,{}),Object(p.jsxs)(b.a,{container:!0,item:!0,className:e.actions,children:[Object(p.jsx)(y.a,{disabled:g,variant:"contained",className:e.create,startIcon:Object(p.jsx)(T.a,{}),onClick:M,children:"New room"}),Object(p.jsx)(S.a,{error:R,disabled:g,variant:"outlined",label:"Enter room id",value:a,onChange:function(e){return o(e.target.value)}}),l&&Object(p.jsx)(y.a,{disabled:g,className:e.join,onClick:A,children:"Join"})]})]})}),Object(p.jsx)(b.a,{container:!0,item:!0,sm:6,justify:"center",alignItems:"center",children:Object(p.jsxs)(E.a,{className:e.video,color:"text.primary",m:1,display:"flex",justifyContent:"center",alignItems:"center",children:[g&&Object(p.jsx)(z.a,{fontSize:"large"}),Object(p.jsx)("video",{ref:P,onLoadedData:function(){return O(!1)},className:e.player,style:{display:g?"none":"block"},muted:!0,autoPlay:!0})]})})]})};var M=Object(f.a)({remote:{position:"relative",width:"640px",height:"480px",backgroundColor:"rgb(0, 0, 0)"},local:{position:"absolute",top:"-120px",right:"-160px",width:"320px",height:"240px",backgroundColor:"rgb(0, 0, 0)",border:"1px solid white"},video:{width:"100%",height:"100%"}});var U=function(){var e=M(),t=Object(s.g)(),n=Object(s.f)(),c=Object(r.useState)(!1),a=Object(j.a)(c,2),o=a[0],i=a[1],u=Object(r.useState)(!0),l=Object(j.a)(u,2),d=l[0],f=l[1],m=Object(r.useState)(!0),g=Object(j.a)(m,2),O=g[0],w=g[1],k=Object(r.useContext)(h),C=k.stream,y=k.setStream,S=Object(r.useRef)(null),D=Object(r.useRef)(null),T=Object(r.useCallback)((function(){N.close(),D.current&&D.current.removeAttribute("srcObject")}),[]);Object(r.useEffect)((function(){L({event:"join",room:t.id}).then((function(e){e?i(!0):n.push("/")}))}),[]),Object(r.useEffect)((function(){o&&(C&&S.current?S.current.srcObject=C:B().then((function(e){e&&(S.current&&(S.current.srcObject=e),y(e))})).catch(console.error))}),[o]);var N=function(e){var t=Object(r.useRef)(null),n=Object(r.useCallback)((function(t){e.handleTrackEvent(t)}),[]),c=Object(r.useCallback)(Object(v.a)(x.a.mark((function e(){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.current.createOffer();case 4:return n=e.sent,e.next=7,t.current.setLocalDescription(n);case 7:return e.next=9,L({event:"call",offer:t.current.localDescription});case 9:case"end":return e.stop()}}),e)}))),[]),a=Object(r.useCallback)(function(){var e=Object(v.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.candidate){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,L({event:"candidate",candidate:t.candidate});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),o=Object(r.useCallback)((function(){t.current&&e.handleICEConnectionStateChangeEvent(t.current.iceConnectionState)}),[]),i=Object(r.useCallback)((function(){t.current&&e.handleSignalingStateChangeEvent(t.current.signalingState)}),[]),s=Object(r.useCallback)((function(){var e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return e.onnegotiationneeded=c,e.ontrack=n,e.onicecandidate=a,e.oniceconnectionstatechange=o,e.onsignalingstatechange=i,e.onremovetrack=function(e){return console.log("onremovetrack",e)},e.onicegatheringstatechange=function(){return console.log("onicegatheringstatechange")},e}),[]);return Object(r.useEffect)((function(){if(e.stream)return P.on("call",n),P.on("answer",c),P.on("candidate",o),function(){P.off("call",n),P.off("answer",c),P.off("candidate",o)};function n(e){return r.apply(this,arguments)}function r(){return(r=Object(v.a)(x.a.mark((function n(r){var c;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("call",r),t.current=s(),n.next=4,t.current.setRemoteDescription(new RTCSessionDescription(r.offer));case 4:return e.stream.getTracks().forEach((function(n){return t.current.addTrack(n,e.stream)})),n.next=7,t.current.createAnswer();case 7:return c=n.sent,n.next=10,t.current.setLocalDescription(new RTCSessionDescription(c));case 10:return n.next=12,L({event:"answer",answer:t.current.localDescription});case 12:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function c(e){return a.apply(this,arguments)}function a(){return(a=Object(v.a)(x.a.mark((function e(n){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("answer",n),t.current){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,t.current.setRemoteDescription(new RTCSessionDescription(n.answer));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function o(e){return i.apply(this,arguments)}function i(){return(i=Object(v.a)(x.a.mark((function e(n){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("candidate",n),t.current){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,t.current.addIceCandidate(n.candidate);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}),[e.stream]),{call:function(){t.current=s(),e.stream.getTracks().forEach((function(n){return t.current.addTrack(n,e.stream)}))},close:function(){t.current&&(t.current.ontrack=null,t.current.onremovetrack=null,t.current.onicecandidate=null,t.current.oniceconnectionstatechange=null,t.current.onsignalingstatechange=null,t.current.onicegatheringstatechange=null,t.current.onnegotiationneeded=null,t.current.close(),t.current=null)}}}({stream:C,handleTrackEvent:function(e){D.current&&(D.current.srcObject=e.streams[0])},handleICEConnectionStateChangeEvent:function(e){switch(e){case"closed":case"failed":case"disconnected":T();break;default:console.log(e)}},handleSignalingStateChangeEvent:function(e){switch(e){case"closed":T();break;default:console.log(e)}}});return Object(r.useEffect)((function(){d||L({event:"participants",room:t.id}).then((function(e){console.log("participants",e),e.length&&N.call()})).catch(console.error)}),[d]),Object(p.jsx)(b.a,{container:!0,alignItems:"center",justify:"center",children:Object(p.jsx)(b.a,{container:!0,item:!0,sm:10,direction:"column",justify:"center",children:Object(p.jsx)(b.a,{container:!0,justify:"center",children:Object(p.jsxs)(E.a,{className:e.remote,color:"text.primary",m:1,display:"flex",justifyContent:"center",alignItems:"center",children:[O&&Object(p.jsx)(z.a,{fontSize:"large"}),Object(p.jsx)("video",{ref:D,onLoadedData:function(){return w(!1)},className:e.video,style:{display:O?"none":"block"},muted:!0,autoPlay:!0}),Object(p.jsxs)(E.a,{className:e.local,color:"text.primary",m:1,display:"flex",justifyContent:"center",alignItems:"center",children:[d&&Object(p.jsx)(z.a,{fontSize:"large"}),Object(p.jsx)("video",{ref:S,onLoadedData:function(){return f(!1)},className:e.video,style:{display:d?"none":"block"},muted:!0,autoPlay:!0})]})]})})})})},_=function(e){e&&n.e(3).then(n.bind(null,194)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))},W=(n(153),n(189));o.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsxs)(u.a,{theme:d,children:[Object(p.jsx)(W.a,{}),Object(p.jsx)(g,{children:Object(p.jsx)(i.a,{children:Object(p.jsxs)(s.c,{children:[Object(p.jsx)(s.a,{exact:!0,path:"/",children:Object(p.jsx)(A,{})}),Object(p.jsx)(s.a,{path:"/:id",children:Object(p.jsx)(U,{})})]})})})]})}),document.getElementById("root")),_()}},[[154,1,2]]]);
//# sourceMappingURL=main.af82a0cb.chunk.js.map