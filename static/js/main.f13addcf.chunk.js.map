{"version":3,"sources":["model.ts","theme.ts","StreamContext.ts","ModelContext.ts","App.tsx","socket.js","getStream.ts","Home.tsx","Room.tsx","useWebRTC.ts","reportWebVitals.ts","index.tsx"],"names":["ProcessingMode","createMuiTheme","palette","type","createContext","stream","setStream","empty","Model","options","net","inited","raf","background","this","Uint32Array","a","self","Promise","resolve","img","Image","onload","canvas","document","createElement","width","height","ctx","getContext","drawImage","data","getImageData","buffer","src","process","console","time","bodyPix","timeEnd","cancelAnimationFrame","mode","render","originalCtx","video","frame","segmentPerson","flipHorizontal","internalResolution","segmentationThreshold","segmentation","ArrayBuffer","length","uint8","Uint8ClampedArray","u32","o","i","r","BACKGROUND","processedCtx","putImageData","ImageData","requestAnimationFrame","Error","stop","audioTracks","getAudioTracks","muted","srcObject","addEventListener","play","videoWidth","videoHeight","original","processed","output","captureStream","forEach","track","addTrack","useStyles","makeStyles","container","position","App","children","styles","useState","model","useMemo","architecture","outputStride","quantBytes","ModelContext","Provider","value","StreamContext","Grid","className","log","socket","io","on","err","request","event","parameters","emit","getStream","navigator","mediaDevices","getUserMedia","frameRate","audio","then","error","name","alert","message","theme","title","marginBottom","spacing","actions","marginTop","create","marginRight","join","marginLeft","backgroundColor","player","button","margin","Home","history","useHistory","room","setRoom","showJoinButton","setShowJoinButton","loading","setLoading","setError","disabled","setDisabled","blur","setBlur","setBackground","useContext","useRef","useEffect","s","catch","current","load","useCallback","push","nanoid","item","sm","alignItems","justify","direction","Typography","variant","Divider","Button","startIcon","onClick","TextField","label","onChange","e","target","Box","color","m","display","justifyContent","fontSize","ref","onLoadedData","style","autoPlay","Fab","BLUR","remote","local","top","right","border","Room","params","useParams","joined","setJoined","connecting","setConnecting","disconnect","removeAttribute","id","status","webrtc","pc","close","ontrack","onremovetrack","onicecandidate","oniceconnectionstatechange","onsignalingstatechange","onicegatheringstatechange","onnegotiationneeded","handleTrackEvent","handleNegotiationNeededEvent","createOffer","offer","setLocalDescription","localDescription","handleICECandidateEvent","candidate","handleICEConnectionStateChangeEvent","state","iceConnectionState","handleSignalingStateChangeEvent","signalingState","createPeerConnection","c","RTCPeerConnection","iceServers","urls","call","answer","off","msg","setRemoteDescription","RTCSessionDescription","getTracks","createAnswer","addIceCandidate","useWebRTC","streams","participants","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","ThemeProvider","CssBaseline","exact","path","getElementById"],"mappings":"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","file":"static/js/main.f13addcf.chunk.js","sourcesContent":["import \"@tensorflow/tfjs\";\nimport * as bodyPix from \"@tensorflow-models/body-pix\";\nimport {\n  BodyPix,\n  ModelConfig,\n} from \"@tensorflow-models/body-pix/dist/body_pix_model\";\n\nexport enum ProcessingMode {\n  BLUR,\n  BACKGROUND,\n}\n\n// little endian\nconst empty = 255 << 24;\n\nexport default class Model {\n  private readonly options: ModelConfig | undefined;\n  private net: BodyPix | null;\n  public inited: boolean;\n  private raf: number | null;\n  private background: Uint32Array;\n\n  constructor(options?: ModelConfig) {\n    /*\n    architecture: \"ResNet50\",\n    outputStride: 32,\n    quantBytes: 1,\n    * */\n    this.options = options;\n    this.net = null;\n    this.raf = null;\n\n    this.inited = false;\n    this.background = new Uint32Array(1);\n  }\n\n  async load() {\n    const self = this;\n\n    await new Promise<void>((resolve) => {\n      const img = new Image();\n      img.onload = () => {\n        const canvas = document.createElement(\"canvas\");\n        const { width, height } = img;\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) return;\n        ctx.drawImage(img, 0, 0);\n        const data = ctx.getImageData(0, 0, width, height).data;\n        self.background = new Uint32Array(data.buffer);\n        resolve();\n      };\n      img.src = `${process.env.PUBLIC_URL}/background.jpeg`;\n    });\n\n    console.time(\"load model\");\n    this.net = await bodyPix.load(this.options);\n    this.inited = true;\n    console.timeEnd(\"load model\");\n  }\n\n  stop() {\n    if (this.raf) {\n      cancelAnimationFrame(this.raf);\n      this.raf = null;\n    }\n  }\n\n  async process(\n    stream: MediaStream,\n    mode: ProcessingMode\n  ): Promise<MediaStream> {\n    if (!this.net) throw new Error(\"net is not ready\");\n    if (!this.background) throw new Error(\"no background\");\n\n    this.stop();\n\n    const self = this; // 😏\n\n    // keep audio\n    const audioTracks = stream.getAudioTracks();\n\n    /*\n     * In order to proceed with the stream we need:\n     * 1. Render this stream in <video>\n     * 2. Render frames in 1st <canvas> (using requestAnimationFrame)\n     * 3. Process the original image\n     * 4. Render output image in 2nd <canvas>\n     * 5. Capture the stream from the 2nd canvas\n     * */\n\n    const video = document.createElement(\"video\");\n    video.muted = true;\n    video.srcObject = stream;\n    await new Promise<void>((resolve) => {\n      video.addEventListener(\"loadedmetadata\", () => {\n        video.play();\n        resolve();\n      });\n    });\n\n    const width = video.videoWidth;\n    const height = video.videoHeight;\n\n    const original = document.createElement(\"canvas\");\n    original.width = width;\n    original.height = height;\n    const originalCtx = original.getContext(\"2d\");\n\n    if (!originalCtx) throw new Error(\"failed to get context from canvas\");\n\n    const processed = document.createElement(\"canvas\");\n    processed.width = width;\n    processed.height = height;\n    const processedCtx = processed.getContext(\"2d\");\n\n    if (!processedCtx) throw new Error(\"failed to get context from canvas\");\n\n    async function render() {\n      // @ts-ignore\n      originalCtx.drawImage(video, 0, 0, width, height);\n      // @ts-ignore\n      const frame = originalCtx.getImageData(0, 0, width, height);\n\n      // @ts-ignore\n      const segmentation = await self.net.segmentPerson(frame, {\n        flipHorizontal: true,\n        internalResolution: \"medium\",\n        segmentationThreshold: 0.7,\n      });\n\n      const data = new ArrayBuffer(frame.data.length);\n      const uint8 = new Uint8ClampedArray(data);\n      const u32 = new Uint32Array(data);\n\n      const o = new Uint32Array(frame.data.buffer);\n\n      for (let i = 0; i < segmentation.data.length; i++) {\n        const r = segmentation.data[i] === 0;\n\n        u32[i] = r\n          ? mode === ProcessingMode.BACKGROUND\n            ? self.background[i]\n            : empty\n          : o[i];\n      }\n\n      // @ts-ignore\n      processedCtx.putImageData(new ImageData(uint8, width, height), 0, 0);\n\n      self.raf = requestAnimationFrame(render);\n    }\n\n    this.raf = requestAnimationFrame(render);\n\n    // @ts-ignore\n    const output = processed.captureStream(25);\n    audioTracks.forEach((track) => output.addTrack(track));\n    return output;\n  }\n}\n","import { createMuiTheme } from \"@material-ui/core\";\n\nexport default createMuiTheme({\n  palette: {\n    type: \"dark\",\n  },\n});\n","import { createContext } from \"react\";\n\ninterface State {\n  stream: MediaStream | null;\n  setStream: (stream: MediaStream | null) => void;\n}\n\nexport default createContext<State>({\n  stream: null,\n  setStream: () => {},\n});\n","import { createContext } from \"react\";\nimport Model from \"./model\";\n\nexport default createContext<Model | null>(null);\n","import React, { useMemo, useState } from \"react\";\nimport { Grid } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport StreamContext from \"./StreamContext\";\nimport ModelContext from \"./ModelContext\";\nimport Model from \"./model\";\n\nconst useStyles = makeStyles({\n  container: {\n    width: \"100vw\",\n    height: \"100vh\",\n    position: \"relative\",\n  },\n});\n\nconst App: React.FC = ({ children }) => {\n  const styles = useStyles();\n  const [stream, setStream] = useState<MediaStream | null>(null);\n\n  // TODO: try different parameters base on device\n  const model = useMemo(\n    () =>\n      new Model({\n        architecture: \"ResNet50\",\n        outputStride: 16,\n        quantBytes: 2,\n      }),\n    []\n  );\n\n  return (\n    <ModelContext.Provider value={model}>\n      <StreamContext.Provider value={{ stream, setStream }}>\n        <Grid container className={styles.container}>\n          {children}\n        </Grid>\n      </StreamContext.Provider>\n    </ModelContext.Provider>\n  );\n};\n\nexport default App;\n","import { io } from \"socket.io-client\";\n\nconsole.log(\"ws server:\", process.env.REACT_APP_SOCKET_IO_SERVER);\nconst socket = io(process.env.REACT_APP_SOCKET_IO_SERVER);\n\nsocket.on(\"connect\", () => console.log(\"connect\"));\nsocket.on(\"reconnect\", () => console.log(\"reconnect\"));\nsocket.on(\"disconnect\", () => console.log(\"disconnect\"));\nsocket.on(\"connect_error\", (err) => console.log(\"connect_error\", err));\n\nexport default socket;\n\nexport function request(options) {\n  const { event, ...parameters } = options;\n  return new Promise((resolve) => {\n    socket.emit(event, parameters, resolve);\n  });\n}\n","export default function getStream(): Promise<MediaStream | null> {\n  if (navigator.mediaDevices) {\n    return navigator.mediaDevices\n      .getUserMedia({\n        video: { width: 320, height: 240, frameRate: 25 },\n        audio: true,\n      })\n      .then(\n        (stream) => {\n          return stream;\n        },\n        (error) => {\n          switch (error.name) {\n            case \"NotFoundError\":\n              alert(\n                \"Unable to open your call because no camera and/or microphone were found.\"\n              );\n              break;\n            case \"SecurityError\":\n            case \"PermissionDeniedError\":\n              alert(\n                \"You can not use video conference w/o granting access to the camera and/or microphone.\"\n              );\n              break;\n            default:\n              alert(\n                \"Error opening your camera and/or microphone: \" + error.message\n              );\n              break;\n          }\n          throw error;\n        }\n      );\n  }\n\n  return Promise.resolve(null);\n}\n","import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { nanoid } from \"nanoid\";\nimport { useHistory } from \"react-router-dom\";\nimport {\n  Box,\n  Button,\n  Divider,\n  Fab,\n  Grid,\n  TextField,\n  Typography,\n} from \"@material-ui/core\";\nimport ForumIcon from \"@material-ui/icons/Forum\";\nimport { request } from \"./socket\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport VideocamOffIcon from \"@material-ui/icons/VideocamOff\";\n\nimport BlurOnIcon from \"@material-ui/icons/BlurOn\";\nimport ImageIcon from \"@material-ui/icons/Image\";\n\nimport StreamContext from \"./StreamContext\";\nimport getStream from \"./getStream\";\nimport ModelContext from \"./ModelContext\";\nimport { ProcessingMode } from \"./model\";\n\nconst useStyles = makeStyles((theme) => ({\n  title: {\n    marginBottom: theme.spacing(2),\n  },\n  actions: {\n    marginTop: theme.spacing(2),\n  },\n  create: {\n    marginRight: theme.spacing(2),\n  },\n  join: {\n    marginLeft: theme.spacing(2),\n  },\n  video: {\n    width: \"640px\",\n    height: \"480px\",\n    backgroundColor: \"rgb(0, 0, 0)\",\n  },\n  player: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  button: {\n    margin: theme.spacing(1),\n  },\n}));\n\nfunction Home() {\n  const styles = useStyles();\n  const history = useHistory();\n\n  const [room, setRoom] = useState(\"\");\n  const [showJoinButton, setShowJoinButton] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [disabled, setDisabled] = useState(true);\n\n  const [blur, setBlur] = useState(false);\n  const [background, setBackground] = useState(false);\n\n  const model = useContext(ModelContext);\n\n  const video = useRef<HTMLVideoElement | null>(null);\n  const { stream, setStream } = useContext(StreamContext);\n\n  useEffect(() => {\n    if (stream) return;\n\n    getStream()\n      .then((s) => {\n        setStream(s);\n      })\n      .catch(console.error);\n  }, []);\n\n  useEffect(() => {\n    if (!stream) return;\n    if (video.current) {\n      video.current.srcObject = stream;\n    }\n  }, [stream]);\n\n  useEffect(() => {\n    if (!model) return;\n    if (!model.inited) {\n      model.load().then(() => setDisabled(false));\n    } else {\n      setDisabled(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    setError(false);\n\n    if (!room.length) setShowJoinButton(false);\n    else setShowJoinButton(true);\n  }, [room]);\n\n  const join = useCallback(async () => {\n    const status = await request({ event: \"join\", room });\n\n    if (status) {\n      history.push(`/${room}`);\n    } else {\n      setError(true);\n    }\n  }, [history, room]);\n\n  const create = useCallback(async () => {\n    const room = nanoid();\n    const status = await request({ event: \"create\", room });\n\n    if (status) {\n      history.push(`/${room}`);\n    }\n  }, [history]);\n\n  function handleBlur() {\n    if (!model || !stream || !model.inited) return;\n\n    setBlur(!blur);\n    setBackground(false);\n\n    if (!blur) {\n      model.process(stream, ProcessingMode.BLUR).then(setStream);\n    } else {\n      getStream().then(setStream);\n    }\n  }\n\n  function handleBackground() {\n    if (!model || !stream || !model.inited) return;\n\n    setBlur(false);\n    setBackground(!background);\n\n    if (!background) {\n      model.process(stream, ProcessingMode.BACKGROUND).then(setStream);\n    } else {\n      getStream().then(setStream);\n    }\n  }\n\n  return (\n    <Grid container>\n      <Grid container item sm={6} alignItems=\"center\" justify=\"flex-end\">\n        <Grid container item sm={10} direction=\"column\">\n          <Grid container direction=\"column\" className={styles.title}>\n            <Typography variant=\"h5\">\n              The most secure video conference powered by WebRTC\n            </Typography>\n            <Typography variant=\"subtitle1\">\n              Create new room or join the existing one\n            </Typography>\n          </Grid>\n          <Divider />\n          <Grid container item className={styles.actions}>\n            <Button\n              disabled={loading}\n              variant=\"contained\"\n              className={styles.create}\n              startIcon={<ForumIcon />}\n              onClick={create}\n            >\n              New room\n            </Button>\n            <TextField\n              error={error}\n              disabled={loading}\n              variant=\"outlined\"\n              label=\"Enter room id\"\n              value={room}\n              onChange={(e) => setRoom(e.target.value)}\n            />\n            {showJoinButton && (\n              <Button disabled={loading} className={styles.join} onClick={join}>\n                Join\n              </Button>\n            )}\n          </Grid>\n        </Grid>\n      </Grid>\n      <Grid\n        container\n        item\n        sm={6}\n        justify=\"center\"\n        alignItems=\"center\"\n        direction=\"column\"\n      >\n        <Box\n          className={styles.video}\n          color=\"text.primary\"\n          m={1}\n          display=\"flex\"\n          justifyContent=\"center\"\n          alignItems=\"center\"\n        >\n          {loading && <VideocamOffIcon fontSize=\"large\" />}\n          <video\n            ref={video}\n            onLoadedData={() => setLoading(false)}\n            className={styles.player}\n            style={{ display: loading ? \"none\" : \"block\" }}\n            muted\n            autoPlay\n          />\n        </Box>\n        <Grid>\n          <Fab\n            color={blur ? \"primary\" : \"default\"}\n            className={styles.button}\n            disabled={disabled}\n            onClick={handleBlur}\n          >\n            <BlurOnIcon fontSize=\"large\" />\n          </Fab>\n          <Fab\n            color={background ? \"primary\" : \"default\"}\n            className={styles.button}\n            disabled={disabled}\n            onClick={handleBackground}\n          >\n            <ImageIcon fontSize=\"large\" />\n          </Fab>\n        </Grid>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport default Home;\n","import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useHistory, useParams } from \"react-router-dom\";\n\nimport { Box, Grid } from \"@material-ui/core\";\nimport { request } from \"./socket\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport useWebRTC from \"./useWebRTC\";\nimport StreamContext from \"./StreamContext\";\nimport VideocamOffIcon from \"@material-ui/icons/VideocamOff\";\nimport getStream from \"./getStream\";\n\nconst useStyles = makeStyles({\n  remote: {\n    position: \"relative\",\n    width: \"640px\",\n    height: \"480px\",\n    backgroundColor: \"rgb(0, 0, 0)\",\n  },\n  local: {\n    position: \"absolute\",\n    top: \"-120px\",\n    right: \"-160px\",\n    width: \"320px\",\n    height: \"240px\",\n    backgroundColor: \"rgb(0, 0, 0)\",\n    border: \"1px solid white\",\n  },\n  video: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n});\n\ninterface RoomParams {\n  id: string;\n}\n\nfunction Room() {\n  const styles = useStyles();\n  const params: RoomParams = useParams();\n  const history = useHistory();\n\n  const [joined, setJoined] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [connecting, setConnecting] = useState(true);\n\n  const { stream, setStream } = useContext(StreamContext);\n\n  const local = useRef<HTMLVideoElement | null>(null);\n  const remote = useRef<HTMLVideoElement | null>(null);\n\n  const disconnect = useCallback(() => {\n    if (remote.current) {\n      remote.current.removeAttribute(\"srcObject\");\n    }\n  }, []);\n\n  useEffect(() => {\n    request({ event: \"join\", room: params.id }).then((status) => {\n      if (!status) {\n        history.push(\"/\");\n      } else {\n        setJoined(true);\n      }\n    });\n  }, []);\n\n  useEffect(() => {\n    if (!joined) return;\n\n    if (stream && local.current) {\n      local.current.srcObject = stream;\n    } else {\n      getStream()\n        .then((stream) => {\n          if (!stream) return;\n          if (local.current) {\n            local.current.srcObject = stream;\n          }\n          setStream(stream);\n        })\n        .catch(console.error);\n    }\n  }, [joined]);\n\n  const webrtc = useWebRTC({\n    stream: stream,\n    handleTrackEvent: (event) => {\n      if (remote.current) {\n        remote.current.srcObject = event.streams[0];\n      }\n    },\n    handleICEConnectionStateChangeEvent: (state) => {\n      switch (state) {\n        case \"closed\":\n        case \"failed\":\n        case \"disconnected\":\n          disconnect();\n          break;\n        default:\n          console.log(state);\n          break;\n      }\n    },\n    handleSignalingStateChangeEvent: (state) => {\n      switch (state) {\n        case \"closed\":\n          disconnect();\n          break;\n        default:\n          console.log(state);\n          break;\n      }\n    },\n  });\n\n  useEffect(() => {\n    if (loading) return;\n\n    request({\n      event: \"participants\",\n      room: params.id,\n    })\n      .then((participants) => {\n        console.log(\"participants\", participants);\n\n        // we are alone here, wait for someone to call us\n        if (!participants.length) return;\n\n        webrtc.call();\n      })\n      .catch(console.error);\n  }, [loading]);\n\n  return (\n    <Grid container alignItems=\"center\" justify=\"center\">\n      <Grid container item sm={10} direction=\"column\" justify=\"center\">\n        <Grid container justify=\"center\">\n          <Box\n            className={styles.remote}\n            color=\"text.primary\"\n            m={1}\n            display=\"flex\"\n            justifyContent=\"center\"\n            alignItems=\"center\"\n          >\n            {connecting && <VideocamOffIcon fontSize=\"large\" />}\n            <video\n              ref={remote}\n              onLoadedData={() => setConnecting(false)}\n              className={styles.video}\n              style={{ display: connecting ? \"none\" : \"block\" }}\n              autoPlay\n            />\n            <Box\n              className={styles.local}\n              color=\"text.primary\"\n              m={1}\n              display=\"flex\"\n              justifyContent=\"center\"\n              alignItems=\"center\"\n            >\n              {loading && <VideocamOffIcon fontSize=\"large\" />}\n              <video\n                ref={local}\n                onLoadedData={() => setLoading(false)}\n                className={styles.video}\n                style={{ display: loading ? \"none\" : \"block\" }}\n                muted\n                autoPlay\n              />\n            </Box>\n          </Box>\n        </Grid>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport default Room;\n","import { useCallback, useEffect, useRef } from \"react\";\nimport socket, { request } from \"./socket\";\n\nexport default function useWebRTC(options: {\n  stream: MediaStream | null;\n  handleTrackEvent: (event: RTCTrackEvent) => void;\n  handleICEConnectionStateChangeEvent: (state: RTCIceConnectionState) => void;\n  handleSignalingStateChangeEvent: (state: RTCSignalingState) => void;\n}) {\n  const pc = useRef<RTCPeerConnection | null>(null);\n\n  const close = useCallback(() => {\n    if (!pc.current) return;\n\n    pc.current.ontrack = null;\n    // @ts-ignore\n    pc.current.onremovetrack = null;\n    pc.current.onicecandidate = null;\n    pc.current.oniceconnectionstatechange = null;\n    pc.current.onsignalingstatechange = null;\n    pc.current.onicegatheringstatechange = null;\n    pc.current.onnegotiationneeded = null;\n\n    pc.current.close();\n    pc.current = null;\n  }, []);\n\n  const handleTrackEvent = useCallback((event) => {\n    options.handleTrackEvent(event);\n  }, []);\n\n  const handleNegotiationNeededEvent = useCallback(async () => {\n    if (!pc.current) return;\n\n    const offer = await pc.current.createOffer();\n    await pc.current.setLocalDescription(offer);\n    await request({ event: \"call\", offer: pc.current.localDescription });\n  }, []);\n\n  const handleICECandidateEvent = useCallback(async (event) => {\n    if (!event.candidate) return;\n    await request({ event: \"candidate\", candidate: event.candidate });\n  }, []);\n\n  const handleICEConnectionStateChangeEvent = useCallback(() => {\n    if (!pc.current) return;\n    const state = pc.current?.iceConnectionState;\n\n    switch (state) {\n      case \"closed\":\n      case \"failed\":\n      case \"disconnected\":\n        close();\n    }\n\n    options.handleICEConnectionStateChangeEvent(state);\n  }, []);\n\n  const handleSignalingStateChangeEvent = useCallback(() => {\n    if (!pc.current) return;\n    const state = pc.current.signalingState;\n\n    switch (state) {\n      case \"closed\":\n        close();\n    }\n\n    options.handleSignalingStateChangeEvent(state);\n  }, []);\n\n  const createPeerConnection = useCallback(() => {\n    const c = new RTCPeerConnection({\n      iceServers: [\n        {\n          urls: \"stun:stun.l.google.com:19302\",\n        },\n      ],\n    });\n\n    c.onnegotiationneeded = handleNegotiationNeededEvent;\n    c.ontrack = handleTrackEvent;\n    c.onicecandidate = handleICECandidateEvent;\n    c.oniceconnectionstatechange = handleICEConnectionStateChangeEvent;\n    c.onsignalingstatechange = handleSignalingStateChangeEvent;\n\n    // @ts-ignore\n    c.onremovetrack = (event) => console.log(\"onremovetrack\", event);\n    c.onicegatheringstatechange = () =>\n      console.log(\"onicegatheringstatechange\");\n\n    return c;\n  }, []);\n\n  useEffect(() => {\n    if (!options.stream) return;\n\n    async function call(msg: { offer: RTCSessionDescriptionInit }) {\n      console.log(\"call\", msg);\n\n      pc.current = createPeerConnection();\n\n      await pc.current.setRemoteDescription(\n        new RTCSessionDescription(msg.offer)\n      );\n\n      // @ts-ignore\n      options.stream\n        .getTracks()\n        // @ts-ignore\n        .forEach((track) => pc.current.addTrack(track, options.stream));\n\n      const answer = await pc.current.createAnswer();\n      await pc.current.setLocalDescription(new RTCSessionDescription(answer));\n      await request({ event: \"answer\", answer: pc.current.localDescription });\n    }\n\n    async function answer(msg: { answer: RTCSessionDescriptionInit }) {\n      console.log(\"answer\", msg);\n\n      if (!pc.current) return;\n\n      await pc.current.setRemoteDescription(\n        new RTCSessionDescription(msg.answer)\n      );\n    }\n\n    async function candidate(msg: { candidate: RTCIceCandidate }) {\n      console.log(\"candidate\", msg);\n\n      if (!pc.current) return;\n\n      await pc.current.addIceCandidate(msg.candidate);\n    }\n\n    socket.on(\"call\", call);\n    socket.on(\"answer\", answer);\n    socket.on(\"candidate\", candidate);\n\n    return () => {\n      socket.off(\"call\", call);\n      socket.off(\"answer\", answer);\n      socket.off(\"candidate\", candidate);\n    };\n  }, [options.stream]);\n\n  return {\n    call() {\n      pc.current = createPeerConnection();\n\n      // @ts-ignore\n      options.stream\n        .getTracks()\n        // @ts-ignore\n        .forEach((track) => pc.current.addTrack(track, options.stream));\n    },\n    close,\n  };\n}\n","import type { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\n\nimport { ThemeProvider } from \"@material-ui/core/styles\";\nimport theme from \"./theme\";\n\nimport App from \"./App\";\nimport Home from \"./Home\";\nimport Room from \"./Room\";\n\nimport reportWebVitals from \"./reportWebVitals\";\n\nimport \"./index.css\";\nimport { CssBaseline } from \"@material-ui/core\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <App>\n        <Router>\n          <Switch>\n            <Route exact path=\"/\">\n              <Home />\n            </Route>\n            <Route path=\"/:id\">\n              <Room />\n            </Route>\n          </Switch>\n        </Router>\n      </App>\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}