{"version":3,"sources":["theme.ts","StreamContext.ts","App.tsx","socket.js","getStream.ts","Home.tsx","Room.tsx","useWebRTC.ts","reportWebVitals.ts","index.tsx"],"names":["createMuiTheme","palette","type","createContext","stream","setStream","useStyles","makeStyles","container","width","height","position","App","children","styles","useState","StreamContext","Provider","value","Grid","className","console","log","process","socket","io","on","err","request","options","event","parameters","Promise","resolve","emit","getStream","navigator","mediaDevices","getUserMedia","video","frameRate","audio","then","error","name","alert","message","theme","title","marginBottom","spacing","actions","marginTop","create","marginRight","join","marginLeft","backgroundColor","player","Home","history","useHistory","room","setRoom","showJoinButton","setShowJoinButton","loading","setLoading","setError","useRef","useContext","useEffect","current","srcObject","catch","length","useCallback","a","push","nanoid","item","sm","alignItems","justify","direction","Typography","variant","Divider","Button","disabled","startIcon","onClick","TextField","label","onChange","e","target","Box","color","m","display","justifyContent","fontSize","ref","onLoadedData","style","muted","autoPlay","remote","local","top","right","border","Room","params","useParams","joined","setJoined","connecting","setConnecting","disconnect","webrtc","close","removeAttribute","id","status","pc","handleTrackEvent","handleNegotiationNeededEvent","createOffer","offer","setLocalDescription","localDescription","handleICECandidateEvent","candidate","handleICEConnectionStateChangeEvent","iceConnectionState","handleSignalingStateChangeEvent","signalingState","createPeerConnection","c","RTCPeerConnection","iceServers","urls","onnegotiationneeded","ontrack","onicecandidate","oniceconnectionstatechange","onsignalingstatechange","onremovetrack","onicegatheringstatechange","call","answer","off","msg","setRemoteDescription","RTCSessionDescription","getTracks","forEach","track","addTrack","createAnswer","addIceCandidate","useWebRTC","streams","state","participants","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","ThemeProvider","CssBaseline","exact","path","document","getElementById"],"mappings":"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","file":"static/js/main.c9dde39f.chunk.js","sourcesContent":["import { createMuiTheme } from \"@material-ui/core\";\n\nexport default createMuiTheme({\n  palette: {\n    type: \"dark\",\n  },\n});\n","import { createContext } from \"react\";\n\ninterface State {\n  stream: MediaStream | null;\n  setStream: (stream: MediaStream | null) => void;\n}\n\nexport default createContext<State>({\n  stream: null,\n  setStream: () => {},\n});\n","import React, { useState } from \"react\";\nimport { Grid } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport StreamContext from \"./StreamContext\";\n\nconst useStyles = makeStyles({\n  container: {\n    width: \"100vw\",\n    height: \"100vh\",\n    position: \"relative\",\n  },\n});\n\nconst App: React.FC = ({ children }) => {\n  const styles = useStyles();\n  const [stream, setStream] = useState<MediaStream | null>(null);\n\n  return (\n    <StreamContext.Provider value={{ stream, setStream }}>\n      <Grid container className={styles.container}>\n        {children}\n      </Grid>\n    </StreamContext.Provider>\n  );\n};\n\nexport default App;\n","import { io } from \"socket.io-client\";\n\nconsole.log(\"ws server:\", process.env.REACT_APP_SOCKET_IO_SERVER);\nconst socket = io(process.env.REACT_APP_SOCKET_IO_SERVER);\n\nsocket.on(\"connect\", () => console.log(\"connect\"));\nsocket.on(\"reconnect\", () => console.log(\"reconnect\"));\nsocket.on(\"disconnect\", () => console.log(\"disconnect\"));\nsocket.on(\"connect_error\", (err) => console.log(\"connect_error\", err));\n\nexport default socket;\n\nexport function request(options) {\n  const { event, ...parameters } = options;\n  return new Promise((resolve) => {\n    socket.emit(event, parameters, resolve);\n  });\n}\n","export default function getStream(): Promise<MediaStream | null> {\n  if (navigator.mediaDevices) {\n    return navigator.mediaDevices\n      .getUserMedia({\n        video: { width: 640, height: 480, frameRate: 30 },\n        // TODO enable audio\n        audio: false,\n      })\n      .then(\n        (stream) => {\n          return stream;\n        },\n        (error) => {\n          switch (error.name) {\n            case \"NotFoundError\":\n              alert(\n                \"Unable to open your call because no camera and/or microphone were found.\"\n              );\n              break;\n            case \"SecurityError\":\n            case \"PermissionDeniedError\":\n              alert(\n                \"You can not use video conference w/o granting access to the camera and/or microphone.\"\n              );\n              break;\n            default:\n              alert(\n                \"Error opening your camera and/or microphone: \" + error.message\n              );\n              break;\n          }\n          throw error;\n        }\n      );\n  }\n\n  return Promise.resolve(null);\n}\n","import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { nanoid } from \"nanoid\";\nimport { useHistory } from \"react-router-dom\";\nimport {\n  Box,\n  Button,\n  Divider,\n  Grid,\n  TextField,\n  Typography,\n} from \"@material-ui/core\";\nimport ForumIcon from \"@material-ui/icons/Forum\";\nimport { request } from \"./socket\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport VideocamOffIcon from \"@material-ui/icons/VideocamOff\";\nimport StreamContext from \"./StreamContext\";\nimport getStream from \"./getStream\";\n\nconst useStyles = makeStyles((theme) => ({\n  title: {\n    marginBottom: theme.spacing(2),\n  },\n  actions: {\n    marginTop: theme.spacing(2),\n  },\n  create: {\n    marginRight: theme.spacing(2),\n  },\n  join: {\n    marginLeft: theme.spacing(2),\n  },\n  video: {\n    width: \"640px\",\n    height: \"480px\",\n    backgroundColor: \"rgb(0, 0, 0)\",\n  },\n  player: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n}));\n\nfunction Home() {\n  const styles = useStyles();\n  const history = useHistory();\n\n  const [room, setRoom] = useState(\"\");\n  const [showJoinButton, setShowJoinButton] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n\n  const video = useRef<HTMLVideoElement | null>(null);\n  const { setStream } = useContext(StreamContext);\n\n  useEffect(() => {\n    getStream()\n      .then((stream) => {\n        if (video.current) {\n          video.current.srcObject = stream;\n        }\n        setStream(stream);\n      })\n      .catch(console.error);\n  }, []);\n\n  useEffect(() => {\n    setError(false);\n\n    if (!room.length) setShowJoinButton(false);\n    else setShowJoinButton(true);\n  }, [room]);\n\n  const join = useCallback(async () => {\n    const status = await request({ event: \"join\", room });\n\n    if (status) {\n      history.push(`/${room}`);\n    } else {\n      setError(true);\n    }\n  }, [history, room]);\n\n  const create = useCallback(async () => {\n    const room = nanoid();\n    const status = await request({ event: \"create\", room });\n\n    if (status) {\n      history.push(`/${room}`);\n    }\n  }, [history]);\n\n  return (\n    <Grid container>\n      <Grid container item sm={6} alignItems=\"center\" justify=\"flex-end\">\n        <Grid container item sm={10} direction=\"column\">\n          <Grid container direction=\"column\" className={styles.title}>\n            <Typography variant=\"h5\">\n              The most secure video conference powered by WebRTC\n            </Typography>\n            <Typography variant=\"subtitle1\">\n              Create new room or join the existing one\n            </Typography>\n          </Grid>\n          <Divider />\n          <Grid container item className={styles.actions}>\n            <Button\n              disabled={loading}\n              variant=\"contained\"\n              className={styles.create}\n              startIcon={<ForumIcon />}\n              onClick={create}\n            >\n              New room\n            </Button>\n            <TextField\n              error={error}\n              disabled={loading}\n              variant=\"outlined\"\n              label=\"Enter room id\"\n              value={room}\n              onChange={(e) => setRoom(e.target.value)}\n            />\n            {showJoinButton && (\n              <Button disabled={loading} className={styles.join} onClick={join}>\n                Join\n              </Button>\n            )}\n          </Grid>\n        </Grid>\n      </Grid>\n      <Grid container item sm={6} justify=\"center\" alignItems=\"center\">\n        <Box\n          className={styles.video}\n          color=\"text.primary\"\n          m={1}\n          display=\"flex\"\n          justifyContent=\"center\"\n          alignItems=\"center\"\n        >\n          {loading && <VideocamOffIcon fontSize=\"large\" />}\n          <video\n            ref={video}\n            onLoadedData={() => setLoading(false)}\n            className={styles.player}\n            style={{ display: loading ? \"none\" : \"block\" }}\n            muted\n            autoPlay\n          />\n        </Box>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport default Home;\n","import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { useHistory, useParams } from \"react-router-dom\";\n\nimport { Box, Grid } from \"@material-ui/core\";\nimport { request } from \"./socket\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport useWebRTC from \"./useWebRTC\";\nimport StreamContext from \"./StreamContext\";\nimport VideocamOffIcon from \"@material-ui/icons/VideocamOff\";\nimport getStream from \"./getStream\";\n\nconst useStyles = makeStyles({\n  remote: {\n    position: \"relative\",\n    width: \"640px\",\n    height: \"480px\",\n    backgroundColor: \"rgb(0, 0, 0)\",\n  },\n  local: {\n    position: \"absolute\",\n    top: \"-120px\",\n    right: \"-160px\",\n    width: \"320px\",\n    height: \"240px\",\n    backgroundColor: \"rgb(0, 0, 0)\",\n    border: \"1px solid white\",\n  },\n  video: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n});\n\ninterface RoomParams {\n  id: string;\n}\n\nfunction Room() {\n  const styles = useStyles();\n  const params: RoomParams = useParams();\n  const history = useHistory();\n\n  const [joined, setJoined] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [connecting, setConnecting] = useState(true);\n\n  const { stream, setStream } = useContext(StreamContext);\n\n  const local = useRef<HTMLVideoElement | null>(null);\n  const remote = useRef<HTMLVideoElement | null>(null);\n\n  const disconnect = useCallback(() => {\n    webrtc.close();\n\n    if (remote.current) {\n      remote.current.removeAttribute(\"srcObject\");\n    }\n  }, []);\n\n  useEffect(() => {\n    request({ event: \"join\", room: params.id }).then((status) => {\n      if (!status) {\n        history.push(\"/\");\n      } else {\n        setJoined(true);\n      }\n    });\n  }, []);\n\n  useEffect(() => {\n    if (!joined) return;\n\n    if (stream && local.current) {\n      local.current.srcObject = stream;\n    } else {\n      getStream()\n        .then((stream) => {\n          if (!stream) return;\n          if (local.current) {\n            local.current.srcObject = stream;\n          }\n          setStream(stream);\n        })\n        .catch(console.error);\n    }\n  }, [joined]);\n\n  const webrtc = useWebRTC({\n    stream: stream,\n    handleTrackEvent: (event) => {\n      if (remote.current) {\n        remote.current.srcObject = event.streams[0];\n      }\n    },\n    handleICEConnectionStateChangeEvent: (state) => {\n      switch (state) {\n        case \"closed\":\n        case \"failed\":\n        case \"disconnected\":\n          disconnect();\n          break;\n        default:\n          console.log(state);\n          break;\n      }\n    },\n    handleSignalingStateChangeEvent: (state) => {\n      switch (state) {\n        case \"closed\":\n          disconnect();\n          break;\n        default:\n          console.log(state);\n          break;\n      }\n    },\n  });\n\n  useEffect(() => {\n    if (loading) return;\n\n    request({\n      event: \"participants\",\n      room: params.id,\n    })\n      .then((participants) => {\n        console.log(\"participants\", participants);\n\n        // we are alone here, wait for someone to call us\n        if (!participants.length) return;\n\n        webrtc.call();\n      })\n      .catch(console.error);\n  }, [loading]);\n\n  return (\n    <Grid container alignItems=\"center\" justify=\"center\">\n      <Grid container item sm={10} direction=\"column\" justify=\"center\">\n        <Grid container justify=\"center\">\n          <Box\n            className={styles.remote}\n            color=\"text.primary\"\n            m={1}\n            display=\"flex\"\n            justifyContent=\"center\"\n            alignItems=\"center\"\n          >\n            {connecting && <VideocamOffIcon fontSize=\"large\" />}\n            <video\n              ref={remote}\n              onLoadedData={() => setConnecting(false)}\n              className={styles.video}\n              style={{ display: connecting ? \"none\" : \"block\" }}\n              muted\n              autoPlay\n            />\n            <Box\n              className={styles.local}\n              color=\"text.primary\"\n              m={1}\n              display=\"flex\"\n              justifyContent=\"center\"\n              alignItems=\"center\"\n            >\n              {loading && <VideocamOffIcon fontSize=\"large\" />}\n              <video\n                ref={local}\n                onLoadedData={() => setLoading(false)}\n                className={styles.video}\n                style={{ display: loading ? \"none\" : \"block\" }}\n                muted\n                autoPlay\n              />\n            </Box>\n          </Box>\n        </Grid>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport default Room;\n","import { useCallback, useEffect, useRef } from \"react\";\nimport socket, { request } from \"./socket\";\n\nexport default function useWebRTC(options: {\n  stream: MediaStream | null;\n  handleTrackEvent: (event: RTCTrackEvent) => void;\n  handleICEConnectionStateChangeEvent: (state: RTCIceConnectionState) => void;\n  handleSignalingStateChangeEvent: (state: RTCSignalingState) => void;\n}) {\n  const pc = useRef<RTCPeerConnection | null>(null);\n\n  const handleTrackEvent = useCallback((event) => {\n    options.handleTrackEvent(event);\n  }, []);\n\n  const handleNegotiationNeededEvent = useCallback(async () => {\n    if (!pc.current) return;\n\n    const offer = await pc.current.createOffer();\n    await pc.current.setLocalDescription(offer);\n    await request({ event: \"call\", offer: pc.current.localDescription });\n  }, []);\n\n  const handleICECandidateEvent = useCallback(async (event) => {\n    if (!event.candidate) return;\n    await request({ event: \"candidate\", candidate: event.candidate });\n  }, []);\n\n  const handleICEConnectionStateChangeEvent = useCallback(() => {\n    if (!pc.current) return;\n    options.handleICEConnectionStateChangeEvent(pc.current.iceConnectionState);\n  }, []);\n\n  const handleSignalingStateChangeEvent = useCallback(() => {\n    if (!pc.current) return;\n    options.handleSignalingStateChangeEvent(pc.current.signalingState);\n  }, []);\n\n  const createPeerConnection = useCallback(() => {\n    const c = new RTCPeerConnection({\n      iceServers: [\n        {\n          urls: \"stun:stun.l.google.com:19302\",\n        },\n      ],\n    });\n\n    c.onnegotiationneeded = handleNegotiationNeededEvent;\n    c.ontrack = handleTrackEvent;\n    c.onicecandidate = handleICECandidateEvent;\n    c.oniceconnectionstatechange = handleICEConnectionStateChangeEvent;\n    c.onsignalingstatechange = handleSignalingStateChangeEvent;\n\n    // @ts-ignore\n    c.onremovetrack = (event) => console.log(\"onremovetrack\", event);\n    c.onicegatheringstatechange = () =>\n      console.log(\"onicegatheringstatechange\");\n\n    return c;\n  }, []);\n\n  useEffect(() => {\n    if (!options.stream) return;\n\n    async function call(msg: { offer: RTCSessionDescriptionInit }) {\n      console.log(\"call\", msg);\n\n      pc.current = createPeerConnection();\n\n      await pc.current.setRemoteDescription(\n        new RTCSessionDescription(msg.offer)\n      );\n\n      // @ts-ignore\n      options.stream\n        .getTracks()\n        // @ts-ignore\n        .forEach((track) => pc.current.addTrack(track, options.stream));\n\n      const answer = await pc.current.createAnswer();\n      await pc.current.setLocalDescription(new RTCSessionDescription(answer));\n      await request({ event: \"answer\", answer: pc.current.localDescription });\n    }\n\n    async function answer(msg: { answer: RTCSessionDescriptionInit }) {\n      console.log(\"answer\", msg);\n\n      if (!pc.current) return;\n\n      await pc.current.setRemoteDescription(\n        new RTCSessionDescription(msg.answer)\n      );\n    }\n\n    async function candidate(msg: { candidate: RTCIceCandidate }) {\n      console.log(\"candidate\", msg);\n\n      if (!pc.current) return;\n\n      await pc.current.addIceCandidate(msg.candidate);\n    }\n\n    socket.on(\"call\", call);\n    socket.on(\"answer\", answer);\n    socket.on(\"candidate\", candidate);\n\n    return () => {\n      socket.off(\"call\", call);\n      socket.off(\"answer\", answer);\n      socket.off(\"candidate\", candidate);\n    };\n  }, [options.stream]);\n\n  return {\n    call() {\n      pc.current = createPeerConnection();\n\n      // @ts-ignore\n      options.stream\n        .getTracks()\n        // @ts-ignore\n        .forEach((track) => pc.current.addTrack(track, options.stream));\n    },\n    close() {\n      if (!pc.current) return;\n\n      pc.current.ontrack = null;\n      // @ts-ignore\n      pc.current.onremovetrack = null;\n      pc.current.onicecandidate = null;\n      pc.current.oniceconnectionstatechange = null;\n      pc.current.onsignalingstatechange = null;\n      pc.current.onicegatheringstatechange = null;\n      pc.current.onnegotiationneeded = null;\n\n      pc.current.close();\n      pc.current = null;\n    },\n  };\n}\n","import type { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\n\nimport { ThemeProvider } from \"@material-ui/core/styles\";\nimport theme from \"./theme\";\n\nimport App from \"./App\";\nimport Home from \"./Home\";\nimport Room from \"./Room\";\n\nimport reportWebVitals from \"./reportWebVitals\";\n\nimport \"./index.css\";\nimport { CssBaseline } from \"@material-ui/core\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <App>\n        <Router>\n          <Switch>\n            <Route exact path=\"/\">\n              <Home />\n            </Route>\n            <Route path=\"/:id\">\n              <Room />\n            </Route>\n          </Switch>\n        </Router>\n      </App>\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}